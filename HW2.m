clear
clc

S = [0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000; 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000; -1.00000000 0.00000000 0.00000000 0.00000000 1.00000000 0.00000000; 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000; 2.00000000 0.00000000 0.00000000 1.00000000 -4.00000000 0.00000000; 0.00000000 -1.00000000 -1.00000000 0.00000000 0.00000000 -1.00000000];
M = [0.00000000 -1.00000000 0.00000000 6.00000000; 0.00000000 0.00000000 1.00000000 0.00000000; -1.00000000 0.00000000 0.00000000 -10.00000000; 0.00000000 0.00000000 0.00000000 1.00000000];
theta = [-2.56400319 -1.21314899 -0.65611402 2.37303739 0.40462678 0.53159290 -0.16354372 -2.83316801 1.90677382 -3.02052357 -1.33291226 2.18491257 2.52732102 -0.29322559 1.02945732 1.70201101 0.01978710; -0.82222207 -0.03981179 2.24510812 2.76900025 0.97242007 -2.44572068 -2.59412573 -2.99026611 1.65817659 2.57283302 1.77554385 -0.52226969 2.90256100 2.62138592 2.55779583 3.04949757 -0.01772533; 2.20322448 -1.07442495 1.21409122 -0.97062213 -3.00980315 -2.44524567 -0.78801441 1.52996934 -1.94653480 -2.81170662 2.95992747 1.90409055 2.16677853 -2.43297296 2.11798565 -1.01558779 2.38795598; 1.85966929 -1.07181253 0.63069677 -2.84958806 -1.02877177 -0.91609499 -1.35087779 -2.88625229 2.28045620 0.69944679 2.61858900 -1.63432722 0.20119503 0.71759596 1.67097381 -2.81318597 -1.23699567; 1.89645851 1.87742575 -0.94981768 -0.87518380 -3.13908688 1.54431009 -2.40714651 1.70180197 -0.67600177 0.67056016 0.98684281 -2.91583643 -2.78438693 -3.06398662 0.85374673 2.13225910 0.93114681; 2.22099783 1.75027879 0.28140634 0.61645324 -2.98895853 2.20635699 -0.22805621 -3.12102522 -0.60122652 0.89854434 -2.61863447 0.16871553 -2.37579204 -2.30761053 -3.13799109 1.63628800 -1.95179767];
r = 0.90000000;

p1i = [2;0;0];
p2i = [2;0;-2];
p3i = [2;0;-6];
p4i = [2;0;-8];
p5i = [4;0;-8];
p6i = [6;0;-8];

S1 = S(:,1);
S2 = S(:,2);
S3 = S(:,3);
S4 = S(:,4);
S5 = S(:,5);
S6 = S(:,6);

i = 1;
[~,n]=size(theta);
c = zeros(1,n);
while i < 3
Te = expm(ssV(S1,theta(1,i)))*expm(ssV(S2,theta(2,i)))*expm(ssV(S3,theta(3,i)))*expm(ssV(S4,theta(4,i)))*expm(ssV(S5,theta(5,i)))*expm(ssV(S6,theta(6,i)))*M;
pe = Te(1:3,4);
pb = [0;0;0];
p1 = p1i;

M2 = [eye(3) p2i; 0 0 0 1];
M3 = [eye(3) p3i; 0 0 0 1];
M4 = [eye(3) p4i; 0 0 0 1];
M5 = [eye(3) p5i; 0 0 0 1];
M6 = [eye(3) p6i; 0 0 0 1];

T2 = expm(ssV(S1,theta(1,i)))*M2;
T3 = expm(ssV(S1,theta(1,i)))*expm(ssV(S2,theta(2,i)))*M3;
T4 = expm(ssV(S1,theta(1,i)))*expm(ssV(S2,theta(2,i)))*expm(ssV(S3,theta(3,i)))*M4;
T5 = expm(ssV(S1,theta(1,i)))*expm(ssV(S2,theta(2,i)))*expm(ssV(S3,theta(3,i)))*expm(ssV(S4,theta(4,i)))*M5;
T6 = expm(ssV(S1,theta(1,i)))*expm(ssV(S2,theta(2,i)))*expm(ssV(S3,theta(3,i)))*expm(ssV(S4,theta(4,i)))*expm(ssV(S5,theta(5,i)))*M6;

p2 = T2(1:3,4);
p3 = T3(1:3,4);
p4 = T4(1:3,4);
p5 = T5(1:3,4);
p6 = T6(1:3,4);

p = [pb p1 p2 p3 p4 p5 p6 pe];

db = zeros(1,7);
db(1) = norm(pb-p1)-r-r;
db(2) = norm(pb-p2)-r-r;
db(3) = norm(pb-p3)-r-r;
db(4) = norm(pb-p4)-r-r;
db(5) = norm(pb-p5)-r-r;
db(6) = norm(pb-p6)-r-r;
db(7) = norm(pb-pe)-r-r;

d1 = zeros(1,6);
d1(1) = norm(p1-p2)-r-r;
d1(2) = norm(p1-p3)-r-r;
d1(3) = norm(p1-p4)-r-r;
d1(4) = norm(p1-p5)-r-r;
d1(5) = norm(p1-p6)-r-r;
d1(6) = norm(p1-pe)-r-r;

d2 = zeros(1,5);
d2(1) = norm(p2-p3)-r-r;
d2(2) = norm(p2-p4)-r-r;
d2(3) = norm(p2-p5)-r-r;
d2(4) = norm(p2-p6)-r-r;
d2(5) = norm(p2-pe)-r-r;

d3 = zeros(1,4);
d3(1) = norm(p3-p4)-r-r;
d3(2) = norm(p3-p5)-r-r;
d3(3) = norm(p3-p6)-r-r;
d3(4) = norm(p3-pe)-r-r;

d4 = zeros(1,3);
d4(1) = norm(p4-p5)-r-r;
d4(2) = norm(p4-p6)-r-r;
d4(3) = norm(p4-pe)-r-r;

d5 = zeros(1,2);
d5(1) = norm(p5-p6)-r-r;
d5(2) = norm(p5-pe)-r-r;

d6e = norm(p6-pe)-r-r;

d = [db d1 d2 d3 d4 d5 d6e];
min_d = min(d);
if min_d < 0
        c(i) = 1;
    else
        c(i) = 0;
end
i = i + 1;
end

disp(mat2str(c,4))